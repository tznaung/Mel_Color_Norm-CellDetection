# Mel_ColorNorm-CellDetection
# Algorithms 
The color normalization algorithm was originally developed using the Macenko MATLAB method to standardize color variations across histopathological images, addressing discrepancies in stain intensity and hue. This ensures consistent color representation, crucial for downstream analyses such as cell segmentation and detection. The algorithm has since been fully integrated into QuPath, offering a streamlined one-click solution for large-scale image processing. Following color normalization, a cell detection algorithm, optimized for these standardized H&E images, is applied to detect cells within the tissue accurately.
# Color Normalization Algorithm
The color normalization process, based on the method developed by Macenko et al., was implemented to address the issue of stain intensity variations in H&E slides, which can significantly impact machine learning algorithms, particularly in cell segmentation tasks. Previously, this process involved splitting large whole-slide images (WSIs) into smaller patches in QuPath, normalizing each patch using the Macenko method in MATLAB, and then stitching them back together in QuPath. To improve efficiency and consistency, the entire color normalization workflow has now been fully integrated into the QuPath pipeline, eliminating the need for separate patching and stitching steps. By using a surrogate "reference" image to extract consistent stain vectors from the filtered optical density (ODhat), these vectors are uniformly applied across the entire WSI, ensuring consistent color normalization and removing the risk of heterogeneity across the image. This streamlined approach provides a more efficient and reliable method for handling large datasets. The color normalization pipeline, along with the instructions can be downloaded from the following link. 
# link: 
# Cell Detection Algorithm
The Cell Detection folder contains the cell detection algorithm and an accompanying instruction manual. The cell detection algorithm (Cells_Calculator_ANNSEP24) was trained on color-normalized H&E stained images. This algorithm detects four distinct cell types: tumor cells, immune cells, stromal cells, and other cells within the tissue microenvironment. Integrated into the algorithm is the functionality to calculate five distinct types of electronic tumor-infiltrating lymphocytes percentage (eTILs%), following the machine-read method of TIL quantification published in Aung et al., EBioMedicine, 2022 (PMID: 35810563; PMCID: PMC9272337; DOI: 10.1016/j.ebiom.2022.104143). This approach enables the quantification of immune infiltration within the tumor microenvironment. After running the algorithm, users can calculate the percentage of TILs based on any selected variables, providing flexibility for various types of analyses. The folder also includes comprehensive instructions for applying the Cell Detection algorithm, detailing each step, from preprocessing images through color normalization to executing cell detection and eTILs% calculation. 
# Contact 
For questions or issues, please contact Thazin Nwe Aung at thazin.aung@yale.edu OR tznaung@gmail.com.
